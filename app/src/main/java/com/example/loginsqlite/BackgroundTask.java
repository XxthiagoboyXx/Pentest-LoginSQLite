package com.example.loginsqlite;

import android.os.AsyncTask;
import android.util.Log;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Scanner;

public class BackgroundTask extends AsyncTask<Void, Void, String>{

    @Override
    protected String doInBackground(Void... voids) { //Execução Async para consumir API

        StringBuilder responseAPI = new StringBuilder();

        //Definindo como será a requisição ao site
        try {
            URL urlPhrase = new URL("https://api.adviceslip.com/advice");

            HttpURLConnection request = (HttpURLConnection) urlPhrase.openConnection();
            request.setRequestMethod("GET");
            request.setRequestProperty("Content-Type","application/json");
            request.setDoOutput(true);
            request.setConnectTimeout(3000);
            request.connect();

            //Para pegar a saída do JSON
            Scanner scanner = new Scanner(urlPhrase.openStream());
            while(scanner.hasNext()){
                responseAPI.append(scanner.nextLine());
            }

        } catch (MalformedURLException e) {
            e.printStackTrace();
        } catch (IOException e2) {
            e2.printStackTrace();
        }


        String tempPhrase = responseAPI.toString(); //converte a resposta do site em string
        return filterPhrase(tempPhrase);
    }

    //Lógica para filtrar apenas o texto necessário
    private String filterPhrase(String tempPhrase) {
        String phrase = "";
        int contColon = 0;
        for (int i = 0; i < tempPhrase.length() - 2; i++) {
            if (contColon > 2) {
                if (contColon == 3) { //Retirar o espaço vazio do início do texto
                    i += 1;
                    contColon += 1;
                }
                phrase += tempPhrase.charAt(i);
            }
            if (tempPhrase.charAt(i) == ':') {
                contColon++;
            }
        }
        return phrase;
    }
    //-----------------------
}
